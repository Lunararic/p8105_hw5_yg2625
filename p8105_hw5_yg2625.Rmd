---
title: "p8105_hw5_yg2625"
author: "Yue Gu"
date: "November 7, 2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Library
```{r, message = F}
library(tidyverse)
library(rvest)
library(purrr)
```

## Problem 1
### Create dataframe containing all file names
```{r}
file_df = tibble(
  list.files(path = "./data", pattern = "*.csv")
  )
names(file_df)[1] = "file_name"

file_df
```

### Iterate over file names and read in data to save the result as a new variable in the dataframe
```{r, message = F}
arm_df = 
  file_df %>% 
  mutate(path = str_c("./data/", file_name)) %>% 
  mutate(data = map(path, read_csv)) %>% 
  unnest()

arm_df

```

### Tidy the resulting data and manipulate file names to include control arm and subject ID and furtherly gather the data and modified week column
```{r}
arm_tidy =
  arm_df %>% 
  select(-path) %>% 
  mutate(file_name = str_replace(file_name, ".csv", "")) %>% 
  separate(file_name, into = c("arm", "subject_id"), sep = "_") %>% 
  gather(key = week, value = obs, week_1:week_8) %>% 
  mutate(week = str_replace(week, "week_", ""))

head(arm_tidy, 10)  
```

### Make a spaghetti plot
```{r}
arm_tidy %>%
  ggplot(aes(x = week, y = obs, group = subject_id, color = subject_id)) +
  geom_point(alpha = .5) +
  geom_line() +
  facet_grid(~arm) +
  theme(legend.position = "bottom") +
  labs(title = "Spaghetti plot showing observations on each subject over time",
       x = "Week",
       y = "Observations")
```

#### By spaghetti plot, we could observe that experimental arm group have relatively higher mean of observations than control arm group. And oberservations increases over time in experimental group while the observations in control group fluctuate around the original value without a clear increasing or decreasing pattern.


## Problem 2

### Import and describe the raw data
```{r}
homi_raw = read_csv("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv")

nrow(homi_raw)
ncol(homi_raw)
```
#### The raw data containing 52179 observations with 12 variables including subject id, case reported date, victim's last and first name, victim's race, age and sex, case happend city and state with latitude and longtitude, and disposition. And the Washington Post collected the data on criminal homicides over the past decade in 50 of the largest American cities.


###  Create a city_state variable (e.g. “Baltimore, MD”) and then summarize within cities to obtain the total number of homicides and the number of unsolved homicides
```{r}
homi_create =
  homi_raw %>% 
  mutate(city_state = paste(city, state, sep = ", ")) %>% 
  group_by(city_state) %>% 
  summarize(homi_total = n(),
            homi_unsoloved = sum(disposition == "Closed without arrest" | disposition == "Open/No arrest"))

head(homi_create, 10)
```

### For the city of Baltimore, MD, use the prop.test function to estimate the proportion of homicides that are unsolved
```{r}

```


